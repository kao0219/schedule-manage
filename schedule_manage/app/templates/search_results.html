{% extends 'base.html' %}
{% block content %}

<h2>「{{ query }}」の検索結果</h2>

<h3>【該当する予定があります】</h3>
<div class="row row-cols-1 row-cols-md-2 g-4">
  {% for schedule in schedules %}
    <div class="col">
      <div class="card h-100">
        {% if schedule.image %}
          <img src="{{ schedule.image.url }}" class="card-img-top" alt="予定画像">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ schedule.schedule_title }}</h5>
          <p class="card-text">{{ schedule.memo|truncatechars:50 }}</p>
          <p class="card-text"><small class="text-muted">{{ schedule.start_time|date:"Y年m月d日" }}</small></p>
        </div>
        <div class="card-footer text-end">
          <a href="{% url 'app:schedule_detail' schedule.id %}" class="btn btn-outline-primary btn-sm">確認</a>
        </div>
      </div>
    </div>
  {% empty %}
    <p>該当する予定はありません。</p>
  {% endfor %}
</div>

<!-- メモ一覧 -->
<h3 class="mt-4">【該当するメモがあります】</h3>
<div class="row row-cols-1 row-cols-md-2 g-4">
  {% for memo in memos %}
    <div class="col">
      <div class="card h-100">
        {% if memo.image %}
          <img src="{{ memo.image.url }}" class="card-img-top" alt="メモ画像">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ memo.memo_title }}</h5>
          <p class="card-text">{{ memo.content|truncatechars:50 }}</p>
        </div>
        <div class="card-footer text-end">
          <button class="btn btn-outline-primary btn-sm"
                  data-bs-toggle="modal"
                  data-bs-target="#memoModal{{ memo.id }}">
            確認
          </button>
        </div>
      </div>
    </div>

    <!-- モーダル本体 -->
    <div class="modal fade" id="memoModal{{ memo.id }}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">メモ確認／編集</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form method="POST" action="{% url 'memo_update' memo.id %}" enctype="multipart/form-data">
              {% csrf_token %}
              {{ memo.form.memo_title.label_tag }}
              {{ memo.form.memo_title }}
              {{ memo.form.content.label_tag }}
              {{ memo.form.content }}
              {{ memo.form.image.label_tag }}
              {{ memo.form.image }}

              {% if memo.image %}
                <p>現在の画像：</p>
                <img src="{{ memo.image.url }}" alt="画像" style="max-width: 200px;">
              {% endif %}

              <div class="d-flex justify-content-between mt-4">
                <a href="#" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</a>
                <a href="{% url 'memo_delete' memo.id %}" class="btn btn-danger"
                   onclick="return confirm('このメモを削除しますか？');">
                  このメモを削除する
                </a>
                <button type="submit" class="btn btn-primary">完了</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  {% empty %}
    <p>該当するメモはありません。</p>
  {% endfor %}
</div>


{% endblock %}