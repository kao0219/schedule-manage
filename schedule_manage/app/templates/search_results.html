{% extends 'base.html' %}
{% block content %}

<style>
   /* 検索タイトル */
   .search-title {
       text-align: center;
       font-size: 28px;
       margin: 30px 0;
       font-weight: bold;
   }
   
   /* セクションタイトル（予定・メモ） */
   .section-title {
       text-align: center;
       font-size: 22px;
       margin: 20px 0;
       color: #555;
   }
   
   /* 該当なしメッセージ */
   .no-result {
       text-align: center;
       color: #999;
       font-size: 16px;
       margin: 30px 0;
   }


</style>


<h2 class="search-title">「{{ query }}」の検索結果</h2>

<h3 class="section-title">【予定】</h3>
<div class="row row-cols-1 row-cols-md-2 g-4">
  {% for schedule in schedules %}
    <div class="col">
      <div class="card h-100">
        {% if schedule.image %}
          <img src="{{ schedule.image.url }}" class="card-img-top" alt="予定画像">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ schedule.schedule_title }}</h5>
          <p class="card-text">{{ schedule.memo|truncatechars:50 }}</p>
          <p class="card-text"><small class="text-muted">{{ schedule.start_time|date:"Y年m月d日" }}</small></p>
        </div>
        <div class="card-footer text-end">
          <a href="{% url 'app:schedule_detail' schedule.id %}" class="btn btn-outline-primary btn-sm">確認</a>
        </div>
      </div>
    </div>
  {% empty %}
    <p class="no-result">該当する予定はありません。</p>
  {% endfor %}
</div>

<!-- メモ一覧 -->
<h3 class="section-title mt-4">【メモ】</h3>
<div class="row row-cols-1 row-cols-md-2 g-4">
  {% for memo in memos %}
   <div class="col">
      <div class="card h-100"
           data-bs-toggle="modal" 
           data-bs-target="#memoModal{{ memo.id }}" 
           style="cursor: pointer;">
          <div class="card-body">
              <h5 class="card-title">{{ memo.memo_title }}</h5>
              <p class="card-text">{{ memo.content|truncatechars:50 }}</p>
          </div>
          {% if memo.image %}
              <img src="{{ memo.image.url }}" class="card-img-top" alt="メモ画像">
          {% endif %}  
      </div>
   </div>

   <!-- 共通モーダル表示用　-->
   {% include "components/memo_modal.html" with memo=memo %}

   {% empty %}
    <p class="no-result">該当するメモはありません。</p>
   {% endfor %}
</div>

{% if updated_memo_id %}
<script>
   document.addEventListener("DOMContentLoaded", function () {
     const targetModal = document.getElementById("memoModal{{ updated_memo_id }}");
     if (targetModal) {
       const modal = new bootstrap.Modal(targetModal);
       modal.show();
     }
   });
 </script>
{% endif %}

{% endblock %}